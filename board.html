<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>이주영 홈페이지</title>
  <link rel="stylesheet" href="css/reset.css" />
  <link rel="stylesheet" href="css/cmmn.css" />
  <link rel="stylesheet" href="css/head.css" />
  <link rel="stylesheet" href="css/header.css" />
  <link rel="stylesheet" href="css/body.css" />
  <link rel="stylesheet" href="css/section.css" />
</head>
<style>
  .btn-group {
    margin: auto;
  }
</style>

<body>
  <header>
    <h1>Hello World!</h1>
    <nav>
      <a href="index.html">Home</a>
      <a href="about.html">About</a>
      <a href="board.html?code=B001">Notice</a>
      <a href="board.html?code=B003">Gallery</a>
      <a href="board.html?code=B006">Design</a>
      <a href="login.html">Login</a>
    </nav>
  </header>
  <div class="wrapper">
    <table>
      <colgroup>
        <col class="no">
        <col class="title">
        <col class="writer">
        <col class="date">
      </colgroup>
      <thead>
        <tr>
          <th class="mobile-hide">번호</th>
          <th id="th-title">제목</th>
          <th class="mobile-hide">작성자</th>
          <th class="mobile-hide">날짜</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>

    <div class="btn-group">
      <button class="btn blue w100">WRITE</button>
    </div>
  </div>
</body>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="js/config.js"></script>
<script src="js/cmmn.js"></script>
<script>
  $(function () {
    board();
  });

  $('.check.all').on('change', function () {
    $('.check').prop('checked', $(this).prop('checked'));
  });

  function board() {
    let urlParams = new URL(location.href).searchParams;
    let page = urlParams.get('page') || '1';
    let code = urlParams.get('code') || '';
    let searchData = {
      code: code,
      page: page,
      search: ''
    };

    $.ajax({
      type: 'GET',
      url: encodeURI(`${apiUrl}board/list`),
      dataType: 'text',
      data: searchData,
      headers: { 'Access-Control-Allow-Origin': '*', 'Content-Type': 'application/json' },
      xhrFields: { withCredentials: true },
      success: (data) => {
        data = JSON.parse(data);
        let status = data.status;
        let message = data.message;

        if (status != '200') {
          alert(message);
          return;
        }

        let pagination = data.data.pagination;
        let searchData = data.data.searchData;
        let result = data.data.result;

        let amount = pagination.amount;
        let end = pagination.end;
        let page = pagination.page;
        let realEnd = pagination.realEnd;
        let start = pagination.start;
        let prev = pagination.prev;
        let next = pagination.next;

        let table = '';
        let pageBox = `<div class="page-box">`;

        // 페이지네이션 생성
        if (prev == true) {
          pageBox += `<a class="btn" href="${url}board.html?code=${code}&page=1">&lt;&lt;</a>
                      <a class="btn" href="${url}board.html?code=${code}&page=${start - amount}">&lt;</a>`;
        }

        for (let i = start; i <= end; i++) {
          if (page == i) {
            pageBox += `<a class="btn number on" href="${url}board.html?code=${code}&page=${i}">${i}</a>`;
          } else {
            pageBox += `<a class="btn number" href="${url}board.html?code=${code}&page=${i}">${i}</a>`;
          }
        }

        if (next == true) {
          pageBox += `<a class="btn" href="${url}board.html?code=${code}&page=${amount + page}">&gt;</a>
                      <a class="btn" href="${url}board.html?code=${code}&page=${realEnd}">&gt;&gt;</a>`;
        }

        pageBox += `</div>`;

        $('table').after(pageBox);

        result.forEach((item, idx) => {
          let date = formattedDate(item.createdAt);

          table += `<tr>
                      <td class="mobile-hide">${item.rowNumber}</td>
                      <td><a href="${url}board-detail.html?code=${code}&page=${page}&board=${item.iboard}">${item.title}</a></td>
                      <td class="mobile-hide">${item.name}</td>
                      <td class="mobile-hide">${date}</td>
                    </tr>`;
        });

        $('table tbody').append(table);
      },
      error: (error, status, errorThrown) => {
        console.log('fail-data        : ', error);
        console.log('fail-status      : ', status);
        console.log('fail-errorThrown : ', errorThrown);
      }
    })
  }
</script>
</html>